YUI.add("moodle-mod_openwebinar-room",function(l,e){M.mod_openwebinar=M.mod_openwebinar||{},M.mod_openwebinar.room={emoticons:{smile:{title:"Smile",codes:[":)",":=)",":-)"]},"sad-smile":{title:"Sad Smile",codes:[":(",":=(",":-("]},"big-smile":{title:"Big Smile",codes:[":D",":=D",":-D",":d",":=d",":-d"]},cool:{title:"Cool",codes:["8)","8=)","8-)","B)","B=)","B-)","(cool)"]},wink:{title:"Wink",codes:[":o",";)",":=o",":-o",":O",":=O",":-O"]},crying:{title:"Crying",codes:[";(",";-(",";=("]},sweating:{title:"Sweating",codes:["(sweat)","(:|"]},speechless:{title:"Speechless",codes:[":|",":=|",":-|"]},kiss:{title:"Kiss",codes:[":*",":=*",":-*"]},"tongue-out":{title:"Tongue Out",codes:[":P",":=P",":-P",":p",":=p",":-p"]},blush:{title:"Blush",codes:["(blush)",":$",":-$",":=$",':">']},wondering:{title:"Wondering",codes:[":^)"]},sleepy:{title:"Sleepy",codes:["|-)","I-)","I=)","(snooze)"]},dull:{title:"Dull",codes:["|(","|-(","|=("]},"in-love":{title:"In love",codes:["(inlove)"]},"evil-grin":{title:"Evil grin",codes:["]:)",">:)","(grin)"]},talking:{title:"Talking",codes:["(talk)"]},yawn:{title:"Yawn",codes:["(yawn)","|-()"]},puke:{title:"Puke",codes:["(puke)",":&",":-&",":=&"]},"doh!":{title:"Doh!",codes:["(doh)"]},angry:{title:"Angry",codes:[":@",":-@",":=@","x(","x-(","x=(","X(","X-(","X=("]},"it-wasnt-me":{title:"It wasn't me",codes:["(wasntme)"]},party:{title:"Party!!!",codes:["(party)"]},worried:{title:"Worried",codes:[":S",":-S",":=S",":s",":-s",":=s"]},mmm:{title:"Mmm...",codes:["(mm)"]},nerd:{title:"Nerd",codes:["8-|","B-|","8|","B|","8=|","B=|","(nerd)"]},"lips-sealed":{title:"Lips Sealed",codes:[":x",":-x",":X",":-X",":#",":-#",":=x",":=X",":=#"]},hi:{title:"Hi",codes:["(hi)"]},call:{title:"Call",codes:["(call)"]},devil:{title:"Devil",codes:["(devil)"]},angel:{title:"Angel",codes:["(angel)"]},envy:{title:"Envy",codes:["(envy)"]},wait:{title:"Wait",codes:["(wait)"]},bear:{title:"Bear",codes:["(bear)","(hug)"]},"make-up":{title:"Make-up",codes:["(makeup)","(kate)"]},"covered-laugh":{title:"Covered Laugh",codes:["(giggle)","(chuckle)"]},"clapping-hands":{title:"Clapping Hands",codes:["(clap)"]},thinking:{title:"Thinking",codes:["(think)",":?",":-?",":=?"]},bow:{title:"Bow",codes:["(bow)"]},rofl:{title:"Rolling on the floor laughing",codes:["(rofl)"]},whew:{title:"Whew",codes:["(whew)"]},happy:{title:"Happy",codes:["(happy)"]},smirking:{title:"Smirking",codes:["(smirk)"]},nodding:{title:"Nodding",codes:["(nod)"]},shaking:{title:"Shaking",codes:["(shake)"]},punch:{title:"Punch",codes:["(punch)"]},emo:{title:"Emo",codes:["(emo)"]},yes:{title:"Yes",codes:["(y)","(Y)","(ok)"]},no:{title:"No",codes:["(n)","(N)"]},handshake:{title:"Shaking Hands",codes:["(handshake)"]},skype:{title:"Skype",codes:["(skype)","(ss)"]},heart:{title:"Heart",codes:["(h)","<3","(H)","(l)","(L)"]},"broken-heart":{title:"Broken heart",codes:["(u)","(U)"]},mail:{title:"Mail",codes:["(e)","(m)"]},flower:{title:"Flower",codes:["(f)","(F)"]},rain:{title:"Rain",codes:["(rain)","(london)","(st)"]},sun:{title:"Sun",codes:["(sun)"]},time:{title:"Time",codes:["(o)","(O)","(time)"]},music:{title:"Music",codes:["(music)"]},movie:{title:"Movie",codes:["(~)","(film)","(movie)"]},phone:{title:"Phone",codes:["(mp)","(ph)"]},coffee:{title:"Coffee",codes:["(coffee)"]},pizza:{title:"Pizza",codes:["(pizza)","(pi)"]},cash:{title:"Cash",codes:["(cash)","(mo)","($)"]},muscle:{title:"Muscle",codes:["(muscle)","(flex)"]},cake:{title:"Cake",codes:["(^)","(cake)"]},beer:{title:"Beer",codes:["(beer)"]},drink:{title:"Drink",codes:["(d)","(D)"]},dance:{title:"Dance",codes:["(dance)","\\o/","\\:D/","\\:d/"]},ninja:{title:"Ninja",codes:["(ninja)"]},star:{title:"Star",codes:["(*)"]},mooning:{title:"Mooning",codes:["(mooning)"]},finger:{title:"Finger",codes:["(finger)"]},bandit:{title:"Bandit",codes:["(bandit)"]},drunk:{title:"Drunk",codes:["(drunk)"]},smoking:{title:"Smoking",codes:["(smoking)","(smoke)","(ci)"]},toivo:{title:"Toivo",codes:["(toivo)"]},rock:{title:"Rock",codes:["(rock)"]},headbang:{title:"Headbang",codes:["(headbang)","(banghead)"]},bug:{title:"Bug",codes:["(bug)"]},fubar:{title:"Fubar",codes:["(fubar)"]},poolparty:{title:"Poolparty",codes:["(poolparty)"]},swearing:{title:"Swearing",codes:["(swear)"]},tmi:{title:"TMI",codes:["(tmi)"]},heidy:{title:"Heidy",codes:["(heidy)"]},myspace:{title:"MySpace",codes:["(MySpace)"]},malthe:{title:"Malthe",codes:["(malthe)"]},tauri:{title:"Tauri",codes:["(tauri)"]},priidu:{title:"Priidu",codes:["(priidu)"]}},emoticons_regex:null,emoticons_map:{},options:{debugjs:!1,preventclosewaring:!1,chat:!1,chatnoticesound:!0,duration:0,timeopen:0,cmid:0,courseid:0,openwebinarid:0,filesharing:!1,filesharing_student:!1,viewhistory:!1,is_ended:!1,showuserpicture:!1,enable_chat_sound:!0,stream:!1,broadcaster:-999,is_broadcaster:!1,broadcastkey:"broadcastkey",broadcaster_identifier:"",shared_secret:"",streaming_server:"",chat_server:"",fullname:"",skype:"",ajax_path:"",usertype:"",userid:0,userlist:!1,ajax_timer:!1,enable_emoticons:!0,questions:!0,multi_domain_hostname:""},userid_from_open_pm_dialog:null,scrollbar_userlist:null,scrollview_chatlist:null,scrollview_chatlist_pm:null,scrollbar_fileoverview:null,scrollbar_chatlist:null,scrollbar_chatlist_pm:null,pm_buffer:{},socket:null,files_uploaded_hashes:{},shortcode_regex:/\[([\w\-_]+)([^\]]*)?\](?:(.+?)?\[\/\1\])?/g,socket_is_connected:null,player:null,audio_newmessage:null,chatobject:{cmid:0,useragent:{},courseid:0,openwebinarid:0,userid:0,fullname:"",skype:"",broadcastkey:"",room:"_public",shared_secret:"",hostname:"",message:"",usertype:"guest"},nodeholder:{chatlist:null,chatlist_pm:null,userlist:null,topmenu:null,leftsidemenu:null,loadhistorybtn:null,userlist_counter:null,sendbutton:null,sendbutton_pm:null,body:null,userlist_viewport:null,chatlist_viewport:null,chatlist_pm_viewport:null,filemanagerdialog:null,fileoverviewdialog:null,fileoverview:null,emoticonsdialog:null,questionmanager:null,addquestionbtn:null,selectquestiontemplatebtn:null,inserttemplatebtn:null,
questionoverview:null,noticebar:null,message:null,message_pm:null},log:function(e){"use strict";this.options.debugjs},init:function(e){"use strict";var t=this;videojs||(t.log("wait.."),setTimeout(function(){t.init(e)},100)),this.set_options(e),this.log("Webinar version - 23-11-2019"),this.log(this.options),this.audio_newmessage=new Audio(M.cfg.wwwroot+"/mod/openwebinar/sound/newmessage.mp3"),l.on("domready",function(){this.log("domready"),setTimeout(function(){t.build_room(),l.one("#openwebinar-loading").hide()},3e3)},this)},build_room:function(){"use strict";var i=this;this.log("build_room"),this.options.is_ended&&(this.options.userlist=!1),this.nodeholder.body=l.one("body"),this.nodeholder.topmenu=l.one("#openwebinar-topbar-left"),this.nodeholder.leftsidemenu=l.one("#openwebinar-left-menu"),this.nodeholder.topmenu.on("click",function(){i.log("Open topmenu"),0===M.mod_openwebinar.room.nodeholder.leftsidemenu.get("offsetWidth")&&0===M.mod_openwebinar.room.nodeholder.leftsidemenu.get("offsetHeight")||"none"===i.nodeholder.leftsidemenu.get("display")?(i.log("show"),YUI().use("anim",function(e){var t=new e.Anim({node:i.nodeholder.leftsidemenu,from:{left:-200},to:{left:0},duration:.3});t.get("node").show(),t.on("end",function(){e.one("#openwebinar-menu").setHTML("&nbsp; Sluiten")}),t.run()})):(i.log("hide"),YUI().use("anim",function(e){var t=new e.Anim({node:i.nodeholder.leftsidemenu,from:{left:0},to:{left:-200},duration:.3});t.on("end",function(){t.get("node").hide(),e.one("#openwebinar-menu").setHTML("&nbsp; Instellingen")}),t.run()}))}),l.all(".openwebinar-toggle").on("click",function(e){this.set_user_setting(e.currentTarget.get("id"),e.currentTarget.get("checked"))},this),this.nodeholder.body.setStyle("overflow","hidden"),this.connect_to_socket(),this.options.stream&&this.add_video(),this.options.userlist?this.add_userlist():l.one("#openwebinar-userlist-holder").hide(),this.options.enable_emoticons&&this.load_emoticons(),this.options.chat?this.add_chat():l.all("#openwebinar-chat-holder .openwebinar-header, #openwebinar-message , #openwebinar-send , #openwebinar-emoticon-icon").hide(),(this.options.filesharing_student&&this.options.broadcaster===this.options.userid||this.options.filesharing_student)&&this.add_fileshare(),this.options.questions&&this.add_question_manager(),l.one("#openwebinar-leave").on("click",function(){if(this.options.is_ended)this.options.preventclosewaring=!0,window.location=M.cfg.wwwroot+"/mod/openwebinar/view.php?id="+this.options.cmid;else if(this.options.is_broadcaster){confirm(M.util.get_string("js:ending_openwebinar","openwebinar",{}))&&l.io(this.options.ajax_path,{method:"GET",data:{sesskey:M.cfg.sesskey,action:"endopenwebinar",extra1:i.options.courseid,extra2:i.options.openwebinarid},on:{success:function(e,t){i.log(e);try{var s=l.JSON.parse(t.responseText);i.log(s),s.status&&(i.chatobject.broadcaster_identifier=i.options.broadcaster_identifier,i.socket.emit("ending",i.chatobject,function(){window.location=M.cfg.wwwroot+"/mod/openwebinar/view.php?id="+this.options.cmid}))}catch(o){i.log(o)}}},headers:{"Content-Type":"application/json"}})}else window.location=M.cfg.wwwroot+"/mod/openwebinar/view.php?id="+this.options.cmid},this),this.add_event(window,"resize",function(){i.scale_room()}),this.warning_message_closing_window(),setTimeout(function(){i.scale_room()},300),this.options.ajax_timer&&!this.options.is_ended&&setInterval(function(){i.ajax_timer_ping()},6e4)},set_user_setting:function(e,t){"use strict";switch(this.log("set_user_setting("+e+","+t+")"),e){case"sound":this.options.enable_chat_sound=Boolean(t);break;case"stream":t?this.add_video():(this.player.dispose(),l.one("#openwebinar-stream-holder").setHTML("")),this.options.stream=t,this.scale_room();break;case"userlist":t?l.one("#openwebinar-userlist-holder").show():l.one("#openwebinar-userlist-holder").hide(),this.options.userlist=t,this.scale_room();break;case"mute_guest":this.chat_mute_usertype("guest",t);break;case"mute_student":this.chat_mute_usertype("student",t);break;case"mute_teacher":this.chat_mute_usertype("teacher",t)}},chat_mute_usertype:function(e,t){"use strict";var s=this;this.options.is_broadcaster&&(this.log("mute("+e+","+t+")"),this.chatobject.broadcaster_identifier=this.options.broadcaster_identifier,this.socket.emit("mute",this.chatobject,e,t,function(e){s.log(e),e.status?s.log(e.mute):s.exception(e.error)}))},ajax_timer_ping:function(){"use strict";var i=this;this.log("ajax_timer_ping"),l.io(this.options.ajax_path,{method:"GET",data:{sesskey:M.cfg.sesskey,action:"ping",extra1:i.options.courseid,extra2:i.options.openwebinarid},on:{success:function(e,t){i.log(e);try{var s=l.JSON.parse(t.responseText);i.log(s),s.status?i.log("You are here for "+s.online_minutes/60+" minutes."):alert(M.util.get_string("js:error_logout_or_lostconnection","openwebinar",{}))}catch(o){i.log(o)}}},headers:{"Content-Type":"application/json"}})},connect_to_socket:function(){"use strict";var e,t=this;for(e in this.chatobject)this.chatobject.hasOwnProperty(e)&&this.options[e]!==undefined&&(this.chatobject[e]=this.options[e]);""!==this.options.multi_domain_hostname?this.chatobject.hostname=this.options.multi_domain_hostname:this.chatobject.hostname=window.location.hostname,this.chatobject.useragent=navigator.userAgent,this.log("connect_to_socket"),this.nodeholder.sendbutton=l.one("#openwebinar-send"),this.nodeholder.message=l.one("#openwebinar-message"),this.nodeholder.sendbutton_pm=l.one("#openwebinar-send-pm"),this.nodeholder.message_pm=l.one("#openwebinar-message-pm"),this.options.is_ended||(this.socket=io.connect(this.options.chat_server),this.socket.on("connect",function(){!1===t.socket_is_connected&&(t.chat_local_message("reconnected"),this.emit("join",t.chatobject,function(e){e.status?t.chat_local_message("joined"):t.exception(e.error)})),t.log("isConnected"),t.socket_is_connected=!0,t.nodeholder.message.removeAttribute("disabled"),t.nodeholder.sendbutton.set("text",M.util.get_string("js:send",
"openwebinar",{})),t.nodeholder.message_pm.removeAttribute("disabled"),t.nodeholder.sendbutton_pm.set("text",M.util.get_string("js:send","openwebinar",{})),t.add_incoming_private_message()}),this.socket.on("reconnect_failed",function(){t.socket_connection_failed("reconnect_failed")}),this.socket.on("openwebinar-ended",function(){t.chat_ended()}),this.socket.on("disconnect",function(){t.socket_connection_failed("disconnect")}),this.socket.on("error",function(){t.log("Socket.io reported a generic error")}))},chat_ended:function(){"use strict";this.chat_local_message("ended");var t=this,e=new l.Panel({contentBox:l.Node.create('<div id="dialog" />'),bodyContent:'<div class="message"><i class="icon-bubble"></i> '+M.util.get_string("js:dialog_ending_text","openwebinar",{})+"</div>",width:410,zIndex:6,modal:!0,render:!0,centered:!0,visible:!1,buttons:{footer:[{name:"proceed",label:M.util.get_string("js:dialog_ending_btn","openwebinar",{}),action:"onOK"}]}});e.onOK=function(e){e.preventDefault(),window.location=M.cfg.wwwroot+"/mod/openwebinar/view.php?id="+t.options.cmid},e.show()},socket_connection_failed:function(e){"use strict";this.log(e),this.socket_is_connected=!1,this.nodeholder.message.setAttribute("disabled","disabled"),this.nodeholder.sendbutton.set("text",M.util.get_string("js:wait_on_connection","openwebinar",{})),this.nodeholder.message_pm.setAttribute("disabled","disabled"),this.nodeholder.sendbutton_pm.set("text",M.util.get_string("js:wait_on_connection","openwebinar",{})),this.chat_local_message(e),this.reset_userlist()},chat_commands:function(e){"use strict";switch(this.log("chat_commands: "+e),e.split(" ")[0]){case"/clear":this.nodeholder.chatlist.setHTML(""),this.scrollbar_chatlist.update("bottom");break;case"/send_question_to_all":break;default:this.chat_local_message("chat_commands")}this.chatobject.message="",this.nodeholder.message.set("value","")},load_chat_history:function(){"use strict";var i=this;l.io(this.options.ajax_path,{method:"GET",data:{sesskey:M.cfg.sesskey,action:"load_public_history",extra1:this.options.courseid,extra2:this.options.openwebinarid},on:{success:function(e,t){this.log("load_chat_history id:"+e);try{var s=l.JSON.parse(t.responseText);this.log(s),s.status&&(i.nodeholder.loadhistorybtn.remove(),i.chat_add_chatrow(s.messages,"prepend",!0))}catch(o){this.log(o)}}},headers:{"Content-Type":"application/json"}},this)},chat_share_file:function(t){"use strict";var s=this;this.chatobject.message="[file "+l.JSON.stringify(t)+"]",this.socket.emit("send",this.chatobject,function(e){e.status?s.files_uploaded_hashes[t.hash]=!0:s.exception(e.error)})},add_incoming_private_message:function(){"use strict";var s=this;s.log("start PM listener."),this.socket.on("new-incoming-private-message",function(e){if(s.log("INCOMING from: "+e.fullname),s.log("ID: "+e.userid),s.log(e),s.pm_buffer[e.userid]===undefined&&(s.pm_buffer[e.userid]=[]),e.messagetype="default",s.pm_buffer[e.userid].push(e),s.log(s.pm_buffer),!l.one("#incoming-"+e.userid)&&s.userid_from_open_pm_dialog!==e.userid){var t='<li id="incoming-'+Number(e.userid)+'"><img src="'+M.cfg.wwwroot+"/user/pix.php?file=/"+Number(e.userid)+'/f1.jpg" /><b class="fullname" data-id="'+Number(e.userid)+'" data-skype="'+s.alpha_numeric(e.skype)+'">'+e.fullname+"</b><span>"+M.util.get_string("js:new_incoming_message","openwebinar",{})+"</span></li>";l.one("#incoming-bar").append(t)}})},load_emoticons:function(){"use strict";var e,t,s,o,i=[];for(e in this.emoticons)if(this.emoticons.hasOwnProperty(e))for(t in s=this.emoticons[e].codes)s.hasOwnProperty(t)&&(o=s[t],this.emoticons_map[o]=e);for(o in this.emoticons_map)this.emoticons_map.hasOwnProperty(o)&&i.push("("+o.replace(/[\[\]{}()*+?.\\|\^$\-,&#\s]/g,"\\$&")+")");this.emoticons_regex=new RegExp(i.join("|"),"g")},add_emoticons:function(e){"use strict";var s=this;return this.options.enable_emoticons?e.replace(this.emoticons_regex,function(e){var t=s.emoticons_map[e];return'<span class="emoticon emoticon-'+t+'" title="'+s.emoticons[t].title+'">'+e+"</span>"}):e},add_video:function(){"use strict";var e,s;this.log("add_video"),e={},s=this,l.Node.create('<video\n    id="room_stream"\n    class="video-js" autoplay\n    controls\n    preload="auto"\n    data-setup=\'{}\'>\n  <p class="vjs-no-js">\n    To view this video please enable JavaScript, and consider upgrading to a\n    web browser that\n    <a href="https://videojs.com/html5-video-support/" target="_blank">\n      supports HTML5 video\n    </a>\n  </p>\n</video>').appendTo("#openwebinar-stream-holder"),this.options.is_ended?this.log("Add offline video if there is one"):e={type:"application/x-mpegURL",src:"http://"+this.options.streaming_server+":8080/hls/"+this.options.broadcastkey+".m3u8"},this.player=videojs("room_stream",{autoplay:!0,preload:"auto",sources:[e]}),this.player.on("waiting",function(){s.log("player_event(waiting)")}),this.player.on("pause",function(){s.log("player_event(pause)")}),this.player.on("play",function(){s.log("player_event(play)")}),this.player.on("ended",function(){s.log("player_event(ended)")}),this.player.on("progress",function(){s.log("player_event(progress)")}),this.player.on("loadedmetadata",function(){s.log("player_event(loadedmetadata)")}),this.player.on("error",function(e){s.log("player_event(error)"),e.stopImmediatePropagation();var t=this.player().error();s.log(t.code+"| |"+t.message),4!=t.code||s.options.is_ended||(this.player().dispose(),l.one("#openwebinar-stream-holder").setHTML('<div class="alert alert-danger">Error videoplayer : '+t.message+'</div><div class="alert">Schakel Flash in <a href="https://get.adobe.com/flashplayer/" target="_blank">Klik hier om Flash in te schakelen</a></div>')),s.log(t.description)}),this.player.on("loadstart",function(){s.log("player_event(loadstart)")}),this.log(e)},add_chat:function(){"use strict";this.log("add_chat");var t=this,e=document.getElementById("openwebinar-chatlist"),s=document.getElementById("openwebinar-chatlist-pm")
;this.scrollbar_chatlist=tinyscrollbar(e),this.nodeholder.chatlist_pm_viewport=l.one("#openwebinar-chatlist-pm .viewport"),this.nodeholder.chatlist_pm_viewport.setStyles({height:300}),this.scrollbar_chatlist_pm=tinyscrollbar(s),this.nodeholder.chatlist=l.one("#openwebinar-chatlist ul"),this.nodeholder.chatlist_pm=l.one("#openwebinar-chatlist-pm ul"),this.nodeholder.loadhistorybtn=l.one("#openwebinar-loadhistory"),this.options.is_ended||(this.chat_local_message("connecting"),this.socket.emit("join",this.chatobject,function(e){e.status?t.chat_local_message("joined"):t.exception(e.error)}),this.socket.on("update-chat",function(e){t.log("update-chat"),t.log(e),t.chat_add_chatrow(e)})),this.nodeholder.sendbutton.on("click",function(){this.chat_send_message()},this),this.nodeholder.sendbutton_pm.on("click",function(){this.chat_send_message_pm()},this),this.options.viewhistory&&(this.nodeholder.loadhistorybtn.show(),this.nodeholder.loadhistorybtn.on("click",function(){this.load_chat_history()},this)),this.options.enable_emoticons&&!this.options.is_ended&&(this.log("Emoticons are enabled"),this.nodeholder.emoticonsdialog=l.one("#openwebinar-emoticons-dialog"),this.nodeholder.emoticonsdialog.delegate("click",function(){t.log("click emo"),t.nodeholder.message.set("value",t.nodeholder.message.get("value")+this.get("text")+" "),t.nodeholder.emoticonsdialog.hide(),t.nodeholder.message.focus()},"span.emoticon"),l.one("#openwebinar-emoticon-icon").on("click",function(){this.log("click on emoticon icon"),l.one("#openwebinar-emoticon-content")||this.chat_build_emoticon_selector(),0===this.nodeholder.emoticonsdialog.get("offsetWidth")&&0===this.nodeholder.emoticonsdialog.get("offsetHeight")||"none"===this.nodeholder.emoticonsdialog.get("display")?(this.log("Show"),this.nodeholder.emoticonsdialog.show()):(this.log("Hide"),this.nodeholder.emoticonsdialog.hide())},this)),this.nodeholder.message.setAttribute("onkeypress","return M.mod_openwebinar.room.chat_enter_listener(event);"),this.nodeholder.message_pm.setAttribute("onkeypress","return M.mod_openwebinar.room.chat_enter_listener(event);")},chat_build_emoticon_selector:function(){"use strict";var e,t="";for(e in this.emoticons)this.emoticons.hasOwnProperty(e)&&(this.log(this.emoticons[e]),t+='<span class="emoticon emoticon-'+e+'" title="'+this.emoticons[e].codes.join(",")+'">'+this.emoticons[e].codes[0]+"</span>");l.Node.create('<div id="openwebinar-emoticon-content">'+t+"</div>").appendTo("#openwebinar-emoticons-dialog div")},chat_enter_listener:function(e){"use strict";if(13===e.keyCode)return this.log("Enter pressed: "+e.target.id),"openwebinar-message-pm"===e.target.id?this.chat_send_message_pm():this.chat_send_message(),!1},chat_add_chatrow:function(e,t,s){"use strict";this.log("chat_add_chatrow");var o,i,n="",a=0,r=!1;if(l.Object.hasKey(e,"message")){if(this.log(e),"default"===e.messagetype){if(r=e.userid===this.options.userid,!(i=this.chat_parse_message(e)))return"";this.options.userid!==e.userid&&this.audio_newmessage&&!s&&this.options.enable_chat_sound&&(this.log("Bleep sound.."),this.audio_newmessage.play()),n+='<li class="openwebinar-chatline openwebinar-'+this.alpha_numeric(e.usertype)+" "+(r?"me":"")+'"><div class="message-container">',this.options.showuserpicture&&(n+='<span class="openwebinar-avatar"><img src="'+M.cfg.wwwroot+"/user/pix.php?file=/"+Number(e.userid)+'/f1.jpg" /></span>'),n+='<span class="openwebinar-username" data-userid="'+Number(e.userid)+'">'+this.alpha_numeric(e.fullname)+'</span><span class="openwebinar-timestamp">'+this.timestamp_to_humanreadable(e.timestamp)+'</span><span class="openwebinar-message">'+i+"</span></div></li>"}else"system"===e.messagetype?n+='<li class="openwebinar-chatline openwebinar-socketserver"><div class="message-container"><span class="openwebinar-username">'+M.util.get_string("js:system_user","openwebinar",{})+'</span><span class="openwebinar-timestamp">'+this.timestamp_to_humanreadable(e.timestamp)+'</span><span class="openwebinar-message">'+M.util.get_string("js:"+e.message,"openwebinar",{})+"</span></div></li>":"local"===e.messagetype&&(a=(new Date).getTime()/1e3,n+='<li class="openwebinar-chatline openwebinar-local"><div class="message-container"><span class="openwebinar-username noSelect">'+M.util.get_string("js:script_user","openwebinar",{})+'</span><span class="openwebinar-timestamp noSelect">'+this.timestamp_to_humanreadable(a)+'</span><span class="openwebinar-message noSelect">'+M.util.get_string("js:"+e.message,"openwebinar",{})+"</span></div></li>");if(s)return n}if(s)for(o in e)e.hasOwnProperty(o)&&(n+=this.chat_add_chatrow(e[o],"",!0));e.ispm===undefined?(this.log("public message"),"prepend"===t?this.nodeholder.chatlist.prepend(n):this.nodeholder.chatlist.append(n),this.scrollbar_chatlist.update("bottom")):(this.log("private message"),this.log(n),"prepend"===t?this.nodeholder.chatlist_pm.prepend(n):this.nodeholder.chatlist_pm.append(n),this.log("scrollbar scroll down."),this.scrollbar_chatlist_pm.update("bottom"))},chat_local_message:function(e){"use strict";var t={messagetype:"local",message:e};this.chat_add_chatrow(t)},chat_parse_message:function(e){"use strict";if("["===e.message.charAt(0)&&"]"===e.message.slice(-1)){var t=this.chat_parse_shortcodes(e);if(t)return t;if(!t)return this.log("Skip message"),!1;this.log("Error: shortcode not replaced")}return this.add_emoticons(l.Node.create("<div/>").setHTML(e.message).get("text"))},chat_parse_shortcodes:function(o){"use strict";var i=!1,n=this;return this.shortcode_regex.test(o.message)&&(this.log("Has some shortcode:"),o.message.replace(this.shortcode_regex,function(e,t,s){switch(n.log(e),t){case"file":i=n.chat_add_shortcode_file(s);break;case"question":i=n.chat_add_shortcode_question(s);break;case"answer":n.chat_add_shortcode_answer(s,o)}})),i},chat_add_shortcode_file:function(e){"use strict";var t,s="";this.log("Add file detail to the chat");try{t=l.JSON.parse(e.slice(1)),this.log(t),
s+='<div class="openwebinar-file"><img src="'+t.thumbnail+'" alt="" /><span class="openwebinar-filename">'+this.alpha_numeric(t.filename)+'</span><span class="openwebinar-filesize">'+this.alpha_numeric(t.filesize)+'</span><span class="openwebinar-fileauthor">'+this.alpha_numeric(t.author)+'</span><a target="_blank" href="'+M.cfg.wwwroot+"/mod/openwebinar/download.php?extra3="+Number(t.id)+"&extra2="+this.options.openwebinarid+"&extra1="+this.options.courseid+"&sesskey="+M.cfg.sesskey+'" class="openwebinar-download openwebinar-button">Download</a></div>'}catch(o){this.log(o)}return this.log(s),s},chat_add_shortcode_question:function(e){"use strict";var t,s="";this.log("Add file detail to the chat");try{t=l.JSON.parse(e.slice(1)),this.log(t),s+='<div class="openwebinar-question"><span class="text">'+t.text+'</span><span class="openwebinar-button answerquestion" data-id="'+t.question_id+'">'+M.util.get_string("js:answer","openwebinar",{})+"</span></div>"}catch(o){this.log(o)}return this.log(s),s},chat_add_shortcode_answer:function(e,t){"use strict";this.log(t);try{var s=l.JSON.parse(e.slice(1));this.options.userid===Number(s.created_by)&&(this.options.is_ended||this.notice_bar_message("added_answer",t))}catch(o){this.log(o)}},timestamp_to_humanreadable:function(e){"use strict";var t=new Date,s=new Date(1e3*e),o="0"+s.getMinutes(),i=s.getHours()+":"+o.substr(-2);return t.toDateString()!==s.toDateString()?s.getDate()+"-"+s.getMonth()+"-"+s.getFullYear()+"<br/>"+i:i},chat_send_message:function(){"use strict";var e,t=String(this.nodeholder.message.get("value")),s=this;"/"!==t.charAt(0)?(e=new RegExp("/(<([^>]+)>)/ig"),t=t.replace(e,""),this.log("Send: "+t),0!==t.length&&(this.chatobject.message=t,this.socket.emit("send",this.chatobject,function(e){e.status||s.chat_local_message(e.error)}),this.chatobject.message="",this.nodeholder.message.set("value",""))):this.chat_commands(t)},chat_send_message_pm:function(){"use strict";var e,t,s=String(this.nodeholder.message_pm.get("value")),o=this;this.log("chat_send_message_pm"),"/"!==s.charAt(0)?(e=new RegExp("/(<([^>]+)>)/ig"),s=s.replace(e,""),this.log("Send: "+s),0!==s.length&&((t=l.clone(this.chatobject,!0)).message=s,t.ispm=!0,t.pm_userid=Number(this.userid_from_open_pm_dialog),t.messagetype="default",t.timestamp=Math.round((new Date).getTime()/1e3),this.pm_buffer[this.userid_from_open_pm_dialog]===undefined&&(this.pm_buffer[this.userid_from_open_pm_dialog]=[]),this.pm_buffer[this.userid_from_open_pm_dialog].push(t),this.socket.emit("send",t,function(){o.log("ID: "+o.userid_from_open_pm_dialog);var e=l.clone(o.chatobject,!0);e.message=s,e.ispm=!0,o.socket.emit("send-notice-user",e,o.userid_from_open_pm_dialog,function(e){e.status?o.log("Notice send"):o.log(e.error)})}),this.nodeholder.message_pm.set("value",""))):this.chat_send_message_pm(s)},exception:function(e){"use strict";this.log("ERROR: "+e)},alpha_numeric:function(e){"use strict";return e.replace(/[^\w\s\.\-\_]/gi,"")},add_userlist:function(){"use strict";var t,s=this,e=document.getElementById("openwebinar-chatlist-pm"),o=document.getElementById("openwebinar-userlist");this.log("add_userlist"),this.nodeholder.userlist=l.one("#openwebinar-userlist ul"),this.nodeholder.userlist_counter=l.one("#openwebinar-usercounter"),this.scrollbar_userlist=tinyscrollbar(o),this.scrollbar_chatlist_pm=tinyscrollbar(e),this.socket.on("update-user-list",function(e){s.update_userlist(e)}),t=new l.Panel({width:400,height:600,zIndex:10,centered:!0,modal:!0,visible:!1,render:!0,srcNode:"#openwebinar-shortprofile",buttons:[{value:"X",section:"header",action:function(e){s.userid_from_open_pm_dialog=null,e.preventDefault(),t.hide()}}]}),s.log(t),l.one("body").delegate("click",function(){var e=Number(this.one(".fullname").getData("id"));s.userid_from_open_pm_dialog=e,s.userid_from_open_pm_dialog!==s.chatobject.userid&&(s.nodeholder.chatlist_pm.setHTML(""),s.log("Open shortprofile: "+this.one(".fullname").get("text")),l.one("#incoming-"+e)&&l.one("#incoming-"+e).remove(),t.show(),l.one("#shortprofile-skype").set("text",this.one(".fullname").getData("skype")),l.one("#shortprofile-fullname").set("text",this.one(".fullname").get("text")),l.one("#shortprofile-avatar").setHTML(this.one("img").cloneNode(!0).setStyles({width:"60px"})),s.connect_to_pm_user(s.userid_from_open_pm_dialog),s.scrollbar_chatlist_pm.update("bottom"))},"#openwebinar-userlist-holder ul li, #incoming-bar li")},connect_to_pm_user:function(e){"use strict";var t,s=this,o=l.clone(s.chatobject,!0);if(o.pm_userid=Number(e),s.socket.emit("join",o,function(e){s.log(e)}),s.pm_buffer[e]!==undefined)for(t in s.log("add history"),s.pm_buffer[e])s.chat_add_chatrow(s.pm_buffer[e][t]);else s.log("no history")},update_userlist_student:function(e){var t,s,o,i,n="";for(t in e.users)if(e.users.hasOwnProperty(t)){if(s=e.users[t],i=l.one("#userlist-user-"+Number(s.userid)),console.log(i),i)continue;o='<li id="userlist-user-'+Number(s.userid)+'" class="openwebinar-'+this.alpha_numeric(s.usertype)+' noSelect">',this.options.showuserpicture&&(o+='<img src="'+M.cfg.wwwroot+"/user/pix.php?file=/"+Number(s.userid)+'/f1.jpg" />'),o+='<span class="fullname" data-id="'+Number(s.userid)+'" data-skype="'+this.alpha_numeric(s.skype)+'">'+this.alpha_numeric(s.fullname)+'</span><span class="browser">'+s.useragent.os.name+" "+s.useragent.os.version+"<br/>"+s.useragent.browser.name+" "+s.useragent.browser.major+"</span>",n+=o+="</li>"}this.nodeholder.userlist.append(n),this.scrollbar_userlist.update(),this.nodeholder.userlist_counter.set("text"," ("+this.nodeholder.userlist.all("li").size()+") ")},update_userlist:function(e){"use strict";var t,s,o,i,n="",a="",r="",l="";if(this.log(e),e.status){if(i=this.nodeholder.userlist.all("li").size(),!this.options.is_broadcaster&&0<i)return this.log("update_userlist_student"),void this.update_userlist_student(e);for(t in this.log("update_userlist"),e.users)if(e.users.hasOwnProperty(t))switch(s=e.users[t],this.log(s),o='<li id="userlist-user-'+Number(
s.userid)+'" class="openwebinar-'+this.alpha_numeric(s.usertype)+' noSelect">',this.options.showuserpicture&&(o+='<img src="'+M.cfg.wwwroot+"/user/pix.php?file=/"+Number(s.userid)+'/f1.jpg" />'),o+='<span class="fullname" data-id="'+Number(s.userid)+'" data-skype="'+this.alpha_numeric(s.skype)+'">'+this.alpha_numeric(s.fullname)+'</span><span class="browser">'+s.useragent.os.name+" "+s.useragent.os.version+"<br/>"+s.useragent.browser.name+" "+s.useragent.browser.major+"</span>",o+="</li>",s.usertype){case"broadcaster":n+=o;break;case"teacher":a+=o;break;case"student":r+=o;break;default:l+=o}this.nodeholder.userlist.setHTML(n+a+r+l),this.scrollbar_userlist.update(),this.nodeholder.userlist_counter.set("text"," ("+e.count+") ")}},reset_userlist:function(){"use strict";this.log("build_room - reset_userlist"),this.nodeholder.userlist.setHTML(""),this.nodeholder.userlist_counter.set("text"," (0) "),this.scrollbar_userlist.update()},add_fileshare:function(){"use strict";var n,e,a="",r=this;this.nodeholder.filemanagerdialog=l.one("#openwebinar-filemanager-dialog"),this.nodeholder.fileoverviewdialog=l.one("#openwebinar-fileoverview-dialog"),e=document.getElementById("openwebinar-fileoverview"),this.scrollbar_fileoverview=tinyscrollbar(e),this.nodeholder.fileoverview=l.one("#openwebinar-fileoverview ul"),l.one("#add-file-btn").on("click",function(){this.log("Add files to the room");var e=l.one("#mform1");l.io(this.options.ajax_path,{method:"POST",data:{sesskey:M.cfg.sesskey,action:"add_file",extra1:this.options.courseid,extra2:this.options.openwebinarid},form:{id:e},on:{success:function(e,t){var s,o,i;r.log(e);try{if(s=l.JSON.parse(t.responseText),r.log(s),s.status)for(i in r.nodeholder.filemanagerdialog.hide(),s.files)if(s.files.hasOwnProperty(i)){if(o=s.files[i].hash,r.files_uploaded_hashes[o]!==undefined){r.log("already shared skip!");continue}r.chat_share_file(s.files[i])}}catch(n){r.log(n)}}}})},this),this.options.is_ended?l.one("#openwebinar-filemanager-btn").hide():l.one("#openwebinar-filemanager-btn").on("click",function(){this.log("Filemanager"),0===this.nodeholder.filemanagerdialog.get("offsetWidth")&&0===this.nodeholder.filemanagerdialog.get("offsetHeight")||"none"===this.nodeholder.filemanagerdialog.get("display")?(this.log("Show"),this.nodeholder.filemanagerdialog.show(),this.nodeholder.fileoverviewdialog.hide()):(this.log("Hide"),this.nodeholder.filemanagerdialog.hide()),this.scale_room()},this),l.one("#openwebinar-fileoverview-btn").on("click",function(){this.log("Filemanager"),0===this.nodeholder.fileoverviewdialog.get("offsetWidth")&&0===this.nodeholder.fileoverviewdialog.get("offsetHeight")||"none"===this.nodeholder.fileoverviewdialog.get("display")?(this.log("Show"),this.nodeholder.fileoverviewdialog.show(),this.nodeholder.filemanagerdialog.hide(),l.io(this.options.ajax_path,{method:"POST",data:{sesskey:M.cfg.sesskey,action:"list_all_files",extra1:this.options.courseid,extra2:this.options.openwebinarid},on:{success:function(e,t){var s,o;r.log(e);try{if(s=l.JSON.parse(t.responseText),r.log(s),s.status){for(o in a="",s.files)s.files.hasOwnProperty(o)&&(n=s.files[o],a+='<li class="openwebinar-file"><img src="'+n.thumbnail+'" alt="" /><span class="openwebinar-filename">'+r.alpha_numeric(n.filename)+'</span><span class="openwebinar-filesize">'+r.alpha_numeric(n.filesize)+'</span><span class="openwebinar-fileauthor">'+r.alpha_numeric(n.author)+'</span><a target="_blank" href="'+M.cfg.wwwroot+"/mod/openwebinar/download.php?extra3="+Number(n.id)+"&extra2="+r.options.openwebinarid+"&extra1="+r.options.courseid+"&sesskey="+M.cfg.sesskey+'" class="openwebinar-download openwebinar-button">Download</a></li>');r.log(a),r.nodeholder.fileoverview.setHTML(a),r.scale_room(),r.scrollbar_fileoverview.update()}}catch(i){r.log(i)}}}})):(this.log("Hide"),this.nodeholder.fileoverviewdialog.hide()),this.scale_room()},this),l.one("body").delegate("click",function(){this.get("parentNode").hide()},".openwebinar-dialog header"),this.log("add_fileshare @todo")},warning_message_closing_window:function(){"use strict";window.onbeforeunload=function(){if(!this.options.preventclosewaring)return M.util.get_string("js:warning_message_closing_window","openwebinar",{})}},load_question_templates:function(){"use strict";var r=this;l.io(M.cfg.wwwroot+"/mod/openwebinar/api.php",{method:"POST",data:{sesskey:M.cfg.sesskey,action:"get_questions_templates",extra1:r.options.courseid,extra2:r.options.openwebinarid},on:{success:function(e,t){var s,o,i,n;r.log(t.response);try{if((s=l.JSON.parse(t.response)).status){for(i in o="",s.questions)s.questions.hasOwnProperty(i)&&(o+='<option value="'+(n=s.questions[i]).id+'">'+n.name+"</option>");l.one("#question-template").setHTML(o)}}catch(a){r.log(a)}},failure:function(e,t){r.log("failure"),r.log(t)}}})},insert_question_template:function(){"use strict";var i=this;l.io(M.cfg.wwwroot+"/mod/openwebinar/api.php",{method:"POST",data:{sesskey:M.cfg.sesskey,action:"select_question_template",extra1:i.options.courseid,extra2:i.options.openwebinarid,extra3:l.one("#question-template option:checked").get("value")},on:{success:function(e,t){i.log(t.response);try{var s=l.JSON.parse(t.response);s.status&&(i.log("question_save Success"),l.one("#question-template-selector")&&l.one("#question-template-selector").hide(),l.one("#all-questions").hide(),i.nodeholder.questionmanager.hide(),i.chat_local_message("added_question"),i.chatobject.message="[question "+l.JSON.stringify(s)+"]",i.socket.emit("send",i.chatobject,function(e){e.status||i.exception(e.error)}))}catch(o){i.log("question_save Exception"),i.log(o)}},failure:function(e,t){i.log("failure"),i.log(t)}}})},add_question_manager:function(){"use strict";var e,t,s,o,i=this;this.log("add_question_manager"),this.nodeholder.questionoverview=l.one("#all-questions .overview > ul"),this.nodeholder.addquestionbtn=l.one("#addquestion"),this.nodeholder.selectquestiontemplatebtn=l.one("#selectquestiontemplate"),this.nodeholder.inserttemplatebtn=l.one(
"#insert-template"),this.nodeholder.questionmanager=new l.Panel({width:"600px",height:"500px",zIndex:10,centered:!0,modal:!0,visible:!1,render:!0,srcNode:"#openwebinar-question-manager"}),l.one("#openwebinar-viewquestion-btn").on("click",function(){this.log("openwebinar-viewquestion-btn"),this.nodeholder.questionmanager.show(),this.question_load_overview()},this),l.one("body").delegate("click",function(){l.one("#question-answer").hide(),l.one("#question-template-selector")&&l.one("#question-template-selector").hide(),l.one("#all-questions").show(),i.question_load_overview()},".openwebinar-back-to-questionoverview"),this.nodeholder.questionoverview.delegate("click",function(){i.question_load_single(this.getData("id"))},".viewquestionbtn"),l.one("body").delegate("click",function(){i.log("Load answer"),i.nodeholder.questionmanager.show(),i.question_load_single(this.getData("id"))},".answerquestion"),this.options.is_ended||(this.nodeholder.addquestionbtn&&(this.nodeholder.selectquestiontemplatebtn.on("click",function(){l.one("#all-questions").hide(),l.one("#question-template-selector").show(),i.load_question_templates()}),this.nodeholder.inserttemplatebtn.on("click",function(){i.insert_question_template()}),this.nodeholder.addquestionbtn.on("click",function(){l.one("#all-questions").hide(),l.one("#question-type-selector").show()}),l.all(".openwebinar-button-previous-step2").on("click",function(){l.all("#question-type-open, #question-type-choice, #question-type-truefalse").hide(),l.one("#question-type-selector").show()},this),l.one("#openwebinar-button-next-step1").on("click",function(){l.one("#question-type-selector").hide();var e=l.one("#question-type").get("value");this.log(e),l.one("#question-type-"+e).show(),this.question_clear_all_input()},this),l.all(".openwebinar-button-previous-step1").on("click",function(){l.one("#all-questions").show(),l.one("#question-template-selector").hide(),l.one("#question-type-selector").hide()},this),e=l.one("#question-truefalse"),(t=l.one("#truefalse-add-btn")).on("click",function(){t.hasClass("disabled")?e.setStyles({border:"1px solid red"}):(e.setStyles({border:"1px solid green"}),t.removeClass("disabled"),this.question_save("truefalse"))},this),e.on("keyup",function(){""!==l.Lang.trim(e.get("value"))?(e.setStyles({border:"1px solid green"}),t.removeClass("disabled")):(e.setStyles({border:"1px solid red"}),t.addClass("disabled"))},this),s=l.one("#open-add-btn"),o=l.one("#question-open"),s.on("click",function(){s.hasClass("disabled")?o.setStyles({border:"1px solid red"}):(o.setStyles({border:"1px solid green"}),s.removeClass("disabled"),this.question_save("open"))},this),o.on("keyup",function(){""!==l.Lang.trim(o.get("value"))?(o.setStyles({border:"1px solid green"}),s.removeClass("disabled")):(o.setStyles({border:"1px solid red"}),s.addClass("disabled"))},this)),l.all("#openwebinar-question-manager form").on("submit",function(e){e.preventDefault()}))},question_clear_all_input:function(){"use strict";l.all('#openwebinar-question-manager input[type="text"], #openwebinar-question-manager textarea').set("value",""),l.all('#openwebinar-question-manager input[type="text"]').setStyles({border:"1px solid red"}),l.all("#open-add-btn , #truefalse-add-bt").addClass("disabled")},question_load_overview:function(){"use strict";var n,a=this,r="";l.one("#question-answer").hide(),l.one("#all-questions").show(),l.io(M.cfg.wwwroot+"/mod/openwebinar/api.php",{method:"POST",data:{sesskey:M.cfg.sesskey,action:"get_questions",extra1:a.options.courseid,extra2:a.options.openwebinarid},on:{success:function(e,t){var s,o;a.log(t.response);try{if((s=l.JSON.parse(t.response)).status){for(o in r="",s.questions)s.questions.hasOwnProperty(o)&&(n=s.questions[o],r+='<li class="'+(n.manager||n.my_answer?"":"unanswered")+'">',r+='<span class="number">#'+o+"</span>",r+='<span class="name">'+n.name+"</span>",r+='<span class="openwebinar-button gray viewquestionbtn" data-id="'+o+'">'+M.util.get_string("btn:view","openwebinar",{})+"</span>",r+="</li>");a.nodeholder.questionoverview.setHTML(r)}}catch(i){a.log(i)}},failure:function(e,t){a.log("failure"),a.log(t)}}})},question_load_single:function(e){"use strict";var i=this;l.io(M.cfg.wwwroot+"/mod/openwebinar/api.php",{method:"POST",data:{sesskey:M.cfg.sesskey,action:"get_question",extra1:i.options.courseid,extra2:i.options.openwebinarid,questionid:e},on:{success:function(e,t){i.log(t.response);try{var s=l.JSON.parse(t.response);s.status&&(l.one("#question-template-selector")&&l.one("#question-template-selector").hide(),l.one("#all-questions").hide(),s.item.form?(l.one("#question-answer").setHTML(s.item.form).show(),i.question_answer()):l.one("#question-answer").setHTML(s.item.answers).show())}catch(o){i.log(o)}},failure:function(e,t){i.log("failure"),i.log(t)}}})},question_answer:function(){"use strict";var t=l.one("#question-submit-answer"),i=this;t.on("submit",function(e){e.preventDefault(),l.io(M.cfg.wwwroot+"/mod/openwebinar/api.php",{method:"POST",form:{id:t,useDisabled:!0},data:{sesskey:M.cfg.sesskey,action:"add_answer",extra1:i.options.courseid,extra2:i.options.openwebinarid},on:{success:function(e,t){i.log(t.response);try{var s=l.JSON.parse(t.response);s.status?(i.nodeholder.questionmanager.hide(),i.chatobject.message="[answer "+l.JSON.stringify(s)+"]",i.socket.emit("send",i.chatobject,function(e){e.status||i.exception(e.error),i.chat_local_message("my_answer_saved")})):(i.log("question_answer Error"),l.one("#question-error").setHTML(s.error).show())}catch(o){i.log("question_answer Exception"),i.log(o)}},failure:function(e,t){i.log("failure"),i.log(t)}}})})},notice_bar_message:function(e,t){"use strict";var s=this;null===this.nodeholder.noticebar&&(this.nodeholder.noticebar=l.one("#openwebinar-noticebar")),0===this.nodeholder.noticebar.get("offsetWidth")&&0===this.nodeholder.noticebar.get("offsetHeight")||"none"===this.nodeholder.noticebar.get("display")?(this.nodeholder.noticebar.setHTML(M.util.get_string("js:"+e,"openwebinar",t)).show(
),setTimeout(function(){s.nodeholder.noticebar.hide()},2e3)):setTimeout(function(){s.notice_bar_message(e,t)},4e3)},question_save:function(e){"use strict";var t=l.one("#question-type-"+e+" form"),i=this;l.io(M.cfg.wwwroot+"/mod/openwebinar/api.php",{method:"POST",form:{id:t,useDisabled:!0},data:{sesskey:M.cfg.sesskey,action:"add_question",extra1:i.options.courseid,extra2:i.options.openwebinarid,questiontype:e},on:{success:function(e,t){i.log(t.response);try{var s=l.JSON.parse(t.response);s.status&&(i.log("question_save Success"),l.all("#question-type-open, #question-type-choice, #question-type-truefalse").hide(),l.one("#all-questions").show(),i.nodeholder.questionmanager.hide(),i.chat_local_message("added_question"),i.chatobject.message="[question "+l.JSON.stringify(s)+"]",i.socket.emit("send",i.chatobject,function(e){e.status||i.exception(e.error)}))}catch(o){i.log("question_save Exception"),i.log(o)}},failure:function(e,t){i.log("failure"),i.log(t)}}})},scale_room:function(){"use strict";var e,t,s,o,i=this.nodeholder.body.get("winWidth"),n=this.nodeholder.body.get("winHeight");null===this.nodeholder.userlist_viewport&&(this.nodeholder.userlist_viewport=l.one("#openwebinar-userlist .viewport"),this.nodeholder.chatlist_viewport=l.one("#openwebinar-chatlist .viewport")),this.log("scale_room for : "+i+"x"+n),this.options.stream&&(t=i-401-40,(o=n-70-80)<(s=Math.round(t/16*9))&&(this.log("Video to high we set it to: "+o),s=o),l.one("#room_stream").setStyles({height:s,width:t})),this.options.userlist&&this.options.chat?(e=n-222,l.one("#openwebinar-userlist .viewport").setStyles({height:.3*e}),this.scrollbar_userlist.update(),e*=.7,l.one("#openwebinar-chatlist .viewport").setStyles({height:e}),this.scrollbar_chatlist.update("bottom")):!this.options.userlist&&this.options.chat?(e=n-186,l.one("#openwebinar-chatlist .viewport").setStyles({height:e}),this.scrollbar_chatlist.update("bottom")):this.options.userlist&&(e=n-186,l.one("#openwebinar-userlist .viewport").setStyles({height:e}),this.scrollbar_userlist.update("bottom")),this.options.filesharing&&(this.options.is_ended||(this.nodeholder.filemanagerdialog.setStyles({height:e+25,"margin-top":-(e+25)}),l.one(".filemanager .fp-content").setStyles({"max-height":e-200})),this.nodeholder.fileoverviewdialog.setStyles({height:e+25,"margin-top":-(e+25)}),l.one("#openwebinar-fileoverview .viewport").setStyles({height:e})),this.options.enable_emoticons&&(this.options.is_ended||this.nodeholder.emoticonsdialog.setStyles({height:e+25,"margin-top":-(e+25)}))},set_options:function(e){"use strict";var t,s;for(t in this.options)this.options.hasOwnProperty(t)&&e.hasOwnProperty(t)&&("boolean"==(s=typeof this.options[t])?this.options[t]=Boolean(e[t]):"number"==s?this.options[t]=Number(e[t]):"string"==s&&(this.options[t]=String(e[t])))},add_event:function(e,t,s){"use strict";null!==e&&e!==undefined&&(e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent?e.attachEvent("on"+t,s):e["on"+t]=s)}}},"@VERSION@",{requires:["base","node","io","anim","panel","json-stringify","json-parse"]});
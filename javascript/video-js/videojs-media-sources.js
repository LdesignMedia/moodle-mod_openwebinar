!function(e){var t,r=0,i=e.MediaSource||e.WebKitMediaSource||{},o=e.URL||{},n=/video\/flv(;\s*codecs=["']vp6,aac["'])?$/,s="blob:vjs-media-source/";t=function(){},t.prototype.init=function(){this.listeners=[]},t.prototype.addEventListener=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].unshift(t)},t.prototype.removeEventListener=function(e,t){for(var r=this.listeners[e],i=r.length;i--;)if(r[i]===t)return r.splice(i,1)},t.prototype.trigger=function(e){for(var t=this.listeners[e.type]||[],r=t.length;r--;)t[r](e)},videojs.MediaSource=function(){var e=this;videojs.MediaSource.prototype.init.call(this),this.sourceBuffers=[],this.readyState="closed",this.listeners={sourceopen:[function(t){e.swfObj=document.getElementById(t.swfId),e.readyState="open",e.swfObj&&e.swfObj.vjs_load()}],webkitsourceopen:[function(){e.trigger({type:"sourceopen"})}]}},videojs.MediaSource.prototype=new t,videojs.MediaSource.BYTES_PER_SECOND_GOAL=4194304,videojs.MediaSource.TICKS_PER_SECOND=60,videojs.MediaSource.prototype.addSourceBuffer=function(e){var t;if(n.test(e))t=new videojs.SourceBuffer(this);else{if(!this.nativeSource)throw new Error("NotSupportedError (Video.js)");t=this.nativeSource.addSourceBuffer.apply(this.nativeSource,arguments)}return this.sourceBuffers.push(t),t},videojs.MediaSource.prototype.endOfStream=function(){this.readyState="ended"},videojs.mediaSources={},videojs.MediaSource.open=function(e,t){var r=videojs.mediaSources[e];if(!r)throw new Error("Media Source not found (Video.js)");r.trigger({type:"sourceopen",swfId:t})},videojs.SourceBuffer=function(t){var r=this,i=[],o=0,n=function(t){e.setTimeout(t,Math.ceil(1e3/videojs.MediaSource.TICKS_PER_SECOND))},s=function(){var t,u,a,d,c,f="";if(i.length){for(c=document.hidden?videojs.MediaSource.BYTES_PER_SECOND_GOAL:Math.ceil(videojs.MediaSource.BYTES_PER_SECOND_GOAL/videojs.MediaSource.TICKS_PER_SECOND),d=new Uint8Array(Math.min(c,o)),u=d.byteLength;u;)t=i[0].subarray(0,u),d.set(t,d.byteLength-u),t.byteLength<i[0].byteLength?i[0]=i[0].subarray(u):i.shift(),u-=t.byteLength;for(o-=d.byteLength,u=0,a=d.byteLength;a>u;u++)f+=String.fromCharCode(d[u]);b64str=e.btoa(f),r.source.swfObj.CallFunction('<invoke name="vjs_appendBuffer"returntype="javascript"><arguments><string>'+b64str+"</string></arguments></invoke>"),0!==o?n(s):(r.updating=!1,r.trigger({type:"updateend"}),"ended"===r.source.readyState&&r.source.swfObj.vjs_endOfStream())}};videojs.SourceBuffer.prototype.init.call(this),this.source=t,this.updating=!1,this.appendBuffer=function(e){var t;if(this.updating)throw t=new Error("SourceBuffer.append() cannot be called while an update is in progress"),t.name="InvalidStateError",t.code=11,t;0===i.length&&n(s),this.updating=!0,this.source.readyState="open",this.trigger({type:"update"}),i.push(e),o+=e.byteLength},this.abort=function(){i=[],o=0,this.source.swfObj.vjs_abort(),this.updating&&(this.updating=!1,this.trigger({type:"updateend"}))}},videojs.SourceBuffer.prototype=new t,videojs.URL={createObjectURL:function(e){var t=s+r;return r++,videojs.mediaSources[t]=e,t}},videojs.plugin("mediaSource",function(){var e=this;e.on("loadstart",function(){var t,r=e.currentSrc(),n=function(e){t.trigger(e)};"Html5"===e.techName&&0===r.indexOf(s)&&(t=videojs.mediaSources[r],t.nativeUrl||(t.nativeSource=new i,t.nativeSource.addEventListener("sourceopen",n,!1),t.nativeSource.addEventListener("webkitsourceopen",n,!1),t.nativeUrl=o.createObjectURL(t.nativeSource)),e.src(t.nativeUrl))})})}(this);